#Two scripts in one, please fix your self to fit into proactive remidation


#Detection script

$Defenderstatus = Get-MpComputerStatus 
$Defenderoutofdate = $Defenderstatus.DefenderSignaturesOutOfDate
$Defenderversion = $Defenderstatus.AntispywareSignatureVersion

Try {
    If ($Defenderoutofdate -eq $false -or $Defenderversion -ge "1.381.2164.0"){
        Write-Output "Compliant, lets enable bugged ASR rule"
        Set-MpPreference -AttackSurfaceReductionRules_Ids 92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b -AttackSurfaceReductionRules_Actions Enabled
        Exit 0
    } 
    Write-Warning "Not Compliant, lets update"
    Exit 1

} 
Catch {
    Write-Warning "Not Compliant, lets update"
    Exit 1
}


#remidate script

Start-Transcript -Path $env:TEMP\copyfile.log
Update-MpSignature

$Defenderstatus = Get-MpComputerStatus
$Defenderoutofdate = $Defenderstatus.DefenderSignaturesOutOfDate
$Defenderversion = $Defenderstatus.AntispywareSignatureVersion

If ($Defenderoutofdate -eq $false -or $Defenderversion -ge "1.381.2164.0"){
    Write-Output "Compliant, lets enable bugged ASR rule"
    Set-MpPreference -AttackSurfaceReductionRules_Ids 92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b -AttackSurfaceReductionRules_Actions Enabled

}
Stop-Transcript
